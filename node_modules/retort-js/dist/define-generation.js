"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.defineGeneration = void 0;
const log_message_1 = require("./log-message");
const message_1 = require("./message");
const openai_chat_completion_1 = require("./openai-chat-completion");
function defineGeneration(conversation, role, push) {
    return async function generation(generationSettings) {
        // let content = await openAiChatCompletion(conversation.settings, messagePromises);
        let message = new message_1.RetortMessage({ role, content: "" });
        let completionPromise = new Promise((resolve) => resolve(message));
        if (push) {
            conversation.messagePromises.push(completionPromise);
        }
        let messagePromises = conversation.messagePromises.slice(0);
        if (conversation.settings.isStreaming) {
            await message.streamContent((0, openai_chat_completion_1.openAiChatCompletion)(conversation.settings, messagePromises));
        }
        else {
            message.currentStream = (0, openai_chat_completion_1.openAiChatCompletion)(conversation.settings, messagePromises);
        }
        await completionPromise;
        (0, log_message_1.logMessage)(message);
        return message;
    };
}
exports.defineGeneration = defineGeneration;
